(function(window,document,undefined){var require=function(){},exports={},module={},__filename="",__dirname="";(function(){function runningInNode(){return typeof require=="function"&&typeof exports=="object"&&typeof module=="object"&&typeof __filename=="string"&&typeof __dirname=="string"}if(!runningInNode()){if(!this.Tautologistics)this.Tautologistics={};else if(this.Tautologistics.NodeHtmlParser)return;this.Tautologistics.NodeHtmlParser={},exports=this.Tautologistics.NodeHtmlParser}var ElementType={Text:"text",Directive:"directive",Comment:"comment",Script:"script",Style:"style",Tag:"tag"};function Parser(handler,options){this._options=options?options:{},this._options.includeLocation==undefined&&(this._options.includeLocation=!1),this.validateHandler(handler),this._handler=handler,this.reset()}Parser._reTrim=/(^\s+|\s+$)/g,Parser._reTrimComment=/(^\!--|--$)/g,Parser._reWhitespace=/\s/g,Parser._reTagName=/^\s*(\/?)\s*([^\s\/]+)/,Parser._reAttrib=/([^=<>\"\'\s]+)\s*=\s*"([^"]*)"|([^=<>\"\'\s]+)\s*=\s*'([^']*)'|([^=<>\"\'\s]+)\s*=\s*([^'"\s]+)|([^=<>\"\'\s\/]+)/g,Parser._reTags=/[\<\>]/g,Parser.prototype.parseComplete=function Parser$parseComplete(data){this.reset(),this.parseChunk(data),this.done()},Parser.prototype.parseChunk=function Parser$parseChunk(data){this._done&&this.handleError(new Error("Attempted to parse chunk after parsing already done")),this._buffer+=data,this.parseTags()},Parser.prototype.done=function Parser$done(){if(!this._done){this._done=!0;if(this._buffer.length){var rawData=this._buffer;this._buffer="";var element={raw:rawData,data:this._parseState==ElementType.Text?rawData:rawData.replace(Parser._reTrim,""),type:this._parseState};if(this._parseState==ElementType.Tag||this._parseState==ElementType.Script||this._parseState==ElementType.Style)element.name=this.parseTagName(element.data);this.parseAttribs(element),this._elements.push(element)}this.writeHandler(),this._handler.done()}},Parser.prototype.reset=function Parser$reset(){this._buffer="",this._done=!1,this._elements=[],this._elementsCurrent=0,this._current=0,this._next=0,this._location={row:0,col:0,charOffset:0,inBuffer:0},this._parseState=ElementType.Text,this._prevTagSep="",this._tagStack=[],this._handler.reset()},Parser.prototype._options=null,Parser.prototype._handler=null,Parser.prototype._buffer=null,Parser.prototype._done=!1,Parser.prototype._elements=null,Parser.prototype._elementsCurrent=0,Parser.prototype._current=0,Parser.prototype._next=0,Parser.prototype._location=null,Parser.prototype._parseState=ElementType.Text,Parser.prototype._prevTagSep="",Parser.prototype._tagStack=null,Parser.prototype.parseTagAttribs=function Parser$parseTagAttribs(elements){var idxEnd=elements.length,idx=0;while(idx<idxEnd){var element=elements[idx++];(element.type==ElementType.Tag||element.type==ElementType.Script||element.type==ElementType.style)&&this.parseAttribs(element)}return elements},Parser.prototype.parseAttribs=function Parser$parseAttribs(element){if(element.type==ElementType.Script||element.type==ElementType.Style||element.type==ElementType.Tag){var tagName=element.data.split(Parser._reWhitespace,1)[0],attribRaw=element.data.substring(tagName.length);if(attribRaw.length<1)return;var match;Parser._reAttrib.lastIndex=0;while(match=Parser._reAttrib.exec(attribRaw))element.attribs==undefined&&(element.attribs={}),typeof match[1]=="string"&&match[1].length?element.attribs[match[1]]=match[2]:typeof match[3]=="string"&&match[3].length?element.attribs[match[3].toString()]=match[4].toString():typeof match[5]=="string"&&match[5].length?element.attribs[match[5]]=match[6]:typeof match[7]=="string"&&match[7].length&&(element.attribs[match[7]]=match[7])}},Parser.prototype.parseTagName=function Parser$parseTagName(data){if(data==null||data=="")return"";var match=Parser._reTagName.exec(data);if(!match)return"";return(match[1]?"/":"")+match[2]},Parser.prototype.parseTags=function Parser$parseTags(){var bufferEnd=this._buffer.length-1;while(Parser._reTags.test(this._buffer)){this._next=Parser._reTags.lastIndex-1;var tagSep=this._buffer.charAt(this._next),rawData=this._buffer.substring(this._current,this._next),element={raw:rawData,data:this._parseState==ElementType.Text?rawData:rawData.replace(Parser._reTrim,""),type:this._parseState},elementName=this.parseTagName(element.data);if(this._tagStack.length)if(this._tagStack[this._tagStack.length-1]==ElementType.Script){if(elementName=="/script")this._tagStack.pop();else if(element.raw.indexOf("!--")!=0){element.type=ElementType.Text;if(this._elements.length&&this._elements[this._elements.length-1].type==ElementType.Text){var prevElement=this._elements[this._elements.length-1];prevElement.raw=prevElement.data=prevElement.raw+this._prevTagSep+element.raw,element.raw=element.data=""}}}else if(this._tagStack[this._tagStack.length-1]==ElementType.Style){if(elementName=="/style")this._tagStack.pop();else if(element.raw.indexOf("!--")!=0){element.type=ElementType.Text;if(this._elements.length&&this._elements[this._elements.length-1].type==ElementType.Text){var prevElement=this._elements[this._elements.length-1];element.raw!=""?(prevElement.raw=prevElement.data=prevElement.raw+this._prevTagSep+element.raw,element.raw=element.data=""):prevElement.raw=prevElement.data=prevElement.raw+this._prevTagSep}else element.raw!=""&&(element.raw=element.data=element.raw)}}else if(this._tagStack[this._tagStack.length-1]==ElementType.Comment){var rawLen=element.raw.length;if(element.raw.charAt(rawLen-2)=="-"&&element.raw.charAt(rawLen-1)=="-"&&tagSep==">"){this._tagStack.pop();if(this._elements.length&&this._elements[this._elements.length-1].type==ElementType.Comment){var prevElement=this._elements[this._elements.length-1];prevElement.raw=prevElement.data=(prevElement.raw+element.raw).replace(Parser._reTrimComment,""),element.raw=element.data="",element.type=ElementType.Text}else element.type=ElementType.Comment}else{element.type=ElementType.Comment;if(this._elements.length&&this._elements[this._elements.length-1].type==ElementType.Comment){var prevElement=this._elements[this._elements.length-1];prevElement.raw=prevElement.data=prevElement.raw+element.raw+tagSep,element.raw=element.data="",element.type=ElementType.Text}else element.raw=element.data=element.raw+tagSep}}if(element.type==ElementType.Tag){element.name=elementName;if(element.raw.indexOf("!--")==0){element.type=ElementType.Comment,delete element.name;var rawLen=element.raw.length;element.raw.charAt(rawLen-1)=="-"&&element.raw.charAt(rawLen-2)=="-"&&tagSep==">"?element.raw=element.data=element.raw.replace(Parser._reTrimComment,""):(element.raw+=tagSep,this._tagStack.push(ElementType.Comment))}else element.raw.indexOf("!")==0||element.raw.indexOf("?")==0?element.type=ElementType.Directive:element.name=="script"?(element.type=ElementType.Script,element.data.charAt(element.data.length-1)!="/"&&this._tagStack.push(ElementType.Script)):element.name=="/script"?element.type=ElementType.Script:element.name=="style"?(element.type=ElementType.Style,element.data.charAt(element.data.length-1)!="/"&&this._tagStack.push(ElementType.Style)):element.name=="/style"&&(element.type=ElementType.Style);element.name&&element.name.charAt(0)=="/"&&(element.data=element.name)}if(element.raw!=""||element.type!=ElementType.Text)this._options.includeLocation&&!element.location&&(element.location=this.getLocation(element.type==ElementType.Tag)),this.parseAttribs(element),this._elements.push(element),element.type!=ElementType.Text&&element.type!=ElementType.Comment&&element.type!=ElementType.Directive&&element.data.charAt(element.data.length-1)=="/"&&this._elements.push({raw:"/"+element.name,data:"/"+element.name,name:"/"+element.name,type:element.type});this._parseState=tagSep=="<"?ElementType.Tag:ElementType.Text,this._current=this._next+1,this._prevTagSep=tagSep}this._options.includeLocation&&(this.getLocation(),this._location.row+=this._location.inBuffer,this._location.inBuffer=0,this._location.charOffset=0),this._buffer=this._current<=bufferEnd?this._buffer.substring(this._current):"",this._current=0,this.writeHandler()},Parser.prototype.getLocation=function Parser$getLocation(startTag){var c,l=this._location,end=this._current-(startTag?1:0),chunk=startTag&&l.charOffset==0&&this._current==0;for(;l.charOffset<end;l.charOffset++)c=this._buffer.charAt(l.charOffset),c=="\n"?(l.inBuffer++,l.col=0):c!="\r"&&l.col++;return{line:l.row+l.inBuffer+1,col:l.col+(chunk?0:1)}},Parser.prototype.validateHandler=function Parser$validateHandler(handler){if(typeof handler!="object")throw new Error("Handler is not an object");if(typeof handler.reset!="function")throw new Error("Handler method 'reset' is invalid");if(typeof handler.done!="function")throw new Error("Handler method 'done' is invalid");if(typeof handler.writeTag!="function")throw new Error("Handler method 'writeTag' is invalid");if(typeof handler.writeText!="function")throw new Error("Handler method 'writeText' is invalid");if(typeof handler.writeComment!="function")throw new Error("Handler method 'writeComment' is invalid");if(typeof handler.writeDirective!="function")throw new Error("Handler method 'writeDirective' is invalid")},Parser.prototype.writeHandler=function Parser$writeHandler(forceFlush){forceFlush=!!forceFlush;if(!this._tagStack.length||!!forceFlush)while(this._elements.length){var element=this._elements.shift();switch(element.type){case ElementType.Comment:this._handler.writeComment(element);break;case ElementType.Directive:this._handler.writeDirective(element);break;case ElementType.Text:this._handler.writeText(element);break;default:this._handler.writeTag(element)}}},Parser.prototype.handleError=function Parser$handleError(error){if(typeof this._handler.error=="function")this._handler.error(error);else throw error};function RssHandler(callback){RssHandler.super_.call(this,callback,{ignoreWhitespace:!0,verbose:!1,enforceEmptyTags:!1})}inherits(RssHandler,DefaultHandler),RssHandler.prototype.done=function RssHandler$done(){var feed={},feedRoot,found=DomUtils.getElementsByTagName(function(value){return value=="rss"||value=="feed"},this.dom,!1);found.length&&(feedRoot=found[0]);if(feedRoot){if(feedRoot.name=="rss"){feed.type="rss",feedRoot=feedRoot.children[0],feed.id="";try{feed.title=DomUtils.getElementsByTagName("title",feedRoot.children,!1)[0].children[0].data}catch(ex){}try{feed.link=DomUtils.getElementsByTagName("link",feedRoot.children,!1)[0].children[0].data}catch(ex){}try{feed.description=DomUtils.getElementsByTagName("description",feedRoot.children,!1)[0].children[0].data}catch(ex){}try{feed.updated=new Date(DomUtils.getElementsByTagName("lastBuildDate",feedRoot.children,!1)[0].children[0].data)}catch(ex){}try{feed.author=DomUtils.getElementsByTagName("managingEditor",feedRoot.children,!1)[0].children[0].data}catch(ex){}feed.items=[],DomUtils.getElementsByTagName("item",feedRoot.children).forEach(function(item,index,list){var entry={};try{entry.id=DomUtils.getElementsByTagName("guid",item.children,!1)[0].children[0].data}catch(ex){}try{entry.title=DomUtils.getElementsByTagName("title",item.children,!1)[0].children[0].data}catch(ex){}try{entry.link=DomUtils.getElementsByTagName("link",item.children,!1)[0].children[0].data}catch(ex){}try{entry.description=DomUtils.getElementsByTagName("description",item.children,!1)[0].children[0].data}catch(ex){}try{entry.pubDate=new Date(DomUtils.getElementsByTagName("pubDate",item.children,!1)[0].children[0].data)}catch(ex){}feed.items.push(entry)})}else{feed.type="atom";try{feed.id=DomUtils.getElementsByTagName("id",feedRoot.children,!1)[0].children[0].data}catch(ex){}try{feed.title=DomUtils.getElementsByTagName("title",feedRoot.children,!1)[0].children[0].data}catch(ex){}try{feed.link=DomUtils.getElementsByTagName("link",feedRoot.children,!1)[0].attribs.href}catch(ex){}try{feed.description=DomUtils.getElementsByTagName("subtitle",feedRoot.children,!1)[0].children[0].data}catch(ex){}try{feed.updated=new Date(DomUtils.getElementsByTagName("updated",feedRoot.children,!1)[0].children[0].data)}catch(ex){}try{feed.author=DomUtils.getElementsByTagName("email",feedRoot.children,!0)[0].children[0].data}catch(ex){}feed.items=[],DomUtils.getElementsByTagName("entry",feedRoot.children).forEach(function(item,index,list){var entry={};try{entry.id=DomUtils.getElementsByTagName("id",item.children,!1)[0].children[0].data}catch(ex){}try{entry.title=DomUtils.getElementsByTagName("title",item.children,!1)[0].children[0].data}catch(ex){}try{entry.link=DomUtils.getElementsByTagName("link",item.children,!1)[0].attribs.href}catch(ex){}try{entry.description=DomUtils.getElementsByTagName("summary",item.children,!1)[0].children[0].data}catch(ex){}try{entry.pubDate=new Date(DomUtils.getElementsByTagName("updated",item.children,!1)[0].children[0].data)}catch(ex){}feed.items.push(entry)})}this.dom=feed}RssHandler.super_.prototype.done.call(this)};function DefaultHandler(callback,options){this.reset(),this._options=options?options:{},this._options.ignoreWhitespace==undefined&&(this._options.ignoreWhitespace=!1),this._options.verbose==undefined&&(this._options.verbose=!0),this._options.enforceEmptyTags==undefined&&(this._options.enforceEmptyTags=!0),typeof callback=="function"&&(this._callback=callback)}DefaultHandler._emptyTags={area:1,base:1,basefont:1,br:1,col:1,frame:1,hr:1,img:1,input:1,isindex:1,link:1,meta:1,param:1,embed:1},DefaultHandler.reWhitespace=/^\s*$/,DefaultHandler.prototype.dom=null,DefaultHandler.prototype.reset=function DefaultHandler$reset(){this.dom=[],this._done=!1,this._tagStack=[],this._tagStack.last=function DefaultHandler$_tagStack$last(){return this.length?this[this.length-1]:null}},DefaultHandler.prototype.done=function DefaultHandler$done(){this._done=!0,this.handleCallback(null)},DefaultHandler.prototype.writeTag=function DefaultHandler$writeTag(element){this.handleElement(element)},DefaultHandler.prototype.writeText=function DefaultHandler$writeText(element){(!this._options.ignoreWhitespace||!DefaultHandler.reWhitespace.test(element.data))&&this.handleElement(element)},DefaultHandler.prototype.writeComment=function DefaultHandler$writeComment(element){this.handleElement(element)},DefaultHandler.prototype.writeDirective=function DefaultHandler$writeDirective(element){this.handleElement(element)},DefaultHandler.prototype.error=function DefaultHandler$error(error){this.handleCallback(error)},DefaultHandler.prototype._options=null,DefaultHandler.prototype._callback=null,DefaultHandler.prototype._done=!1,DefaultHandler.prototype._tagStack=null,DefaultHandler.prototype.handleCallback=function DefaultHandler$handleCallback(error){if(typeof this._callback!="function"){if(error)throw error}else this._callback(error,this.dom)},DefaultHandler.prototype.isEmptyTag=function(element){var name=element.name.toLowerCase();name.charAt(0)=="/"&&(name=name.substring(1));return this._options.enforceEmptyTags&&!!DefaultHandler._emptyTags[name]},DefaultHandler.prototype.handleElement=function DefaultHandler$handleElement(element){this._done&&this.handleCallback(new Error("Writing to the handler after done() called is not allowed without a reset()")),this._options.verbose||(delete element.raw,(element.type=="tag"||element.type=="script"||element.type=="style")&&delete element.data);if(!this._tagStack.last())element.type!=ElementType.Text&&element.type!=ElementType.Comment&&element.type!=ElementType.Directive?element.name.charAt(0)!="/"&&(this.dom.push(element),this.isEmptyTag(element)||this._tagStack.push(element)):this.dom.push(element);else if(element.type!=ElementType.Text&&element.type!=ElementType.Comment&&element.type!=ElementType.Directive)if(element.name.charAt(0)=="/"){var baseName=element.name.substring(1);if(!this.isEmptyTag(element)){var pos=this._tagStack.length-1;while(pos>-1&&this._tagStack[pos--].name!=baseName){}if(pos>-1||this._tagStack[0].name==baseName)while(pos<this._tagStack.length-1)this._tagStack.pop()}}else this._tagStack.last().children||(this._tagStack.last().children=[]),this._tagStack.last().children.push(element),this.isEmptyTag(element)||this._tagStack.push(element);else this._tagStack.last().children||(this._tagStack.last().children=[]),this._tagStack.last().children.push(element)};var DomUtils={testElement:function DomUtils$testElement(options,element){if(!element)return!1;for(var key in options)if(key=="tag_name"){if(element.type!="tag"&&element.type!="script"&&element.type!="style")return!1;if(!options.tag_name(element.name))return!1}else if(key=="tag_type"){if(!options.tag_type(element.type))return!1}else if(key=="tag_contains"){if(element.type!="text"&&element.type!="comment"&&element.type!="directive")return!1;if(!options.tag_contains(element.data))return!1}else if(!element.attribs||!options[key](element.attribs[key]))return!1;return!0},getElements:function DomUtils$getElements(options,currentElement,recurse,limit){recurse=recurse===undefined||recurse===null||!!recurse,limit=isNaN(parseInt(limit))?-1:parseInt(limit);if(!currentElement)return[];var found=[],elementList;function getTest(checkVal){return function(value){return value==checkVal}}for(var key in options)typeof options[key]!="function"&&(options[key]=getTest(options[key]));DomUtils.testElement(options,currentElement)&&found.push(currentElement);if(limit>=0&&found.length>=limit)return found;if(recurse&&currentElement.children)elementList=currentElement.children;else if(currentElement instanceof Array)elementList=currentElement;else return found;for(var i=0;i<elementList.length;i++){found=found.concat(DomUtils.getElements(options,elementList[i],recurse,limit));if(limit>=0&&found.length>=limit)break}return found},getElementById:function DomUtils$getElementById(id,currentElement,recurse){var result=DomUtils.getElements({id:id},currentElement,recurse,1);return result.length?result[0]:null},getElementsByTagName:function DomUtils$getElementsByTagName(name,currentElement,recurse,limit){return DomUtils.getElements({tag_name:name},currentElement,recurse,limit)},getElementsByTagType:function DomUtils$getElementsByTagType(type,currentElement,recurse,limit){return DomUtils.getElements({tag_type:type},currentElement,recurse,limit)}};function inherits(ctor,superCtor){var tempCtor=function(){};tempCtor.prototype=superCtor.prototype,ctor.super_=superCtor,ctor.prototype=new tempCtor,ctor.prototype.constructor=ctor}exports.Parser=Parser,exports.DefaultHandler=DefaultHandler,exports.RssHandler=RssHandler,exports.ElementType=ElementType,exports.DomUtils=DomUtils})(),function(window,document,options,html){var DJSUtil=window._||{};DJSUtil.epoch=(new Date).getTime(),DJSUtil.log=function(out){if(options.verbose)try{console.log("[ DJS ] "+out)}catch(e){}},DJSUtil.error=function(out){if(options.verbose)try{console.error("[ DJS ] "+out)}catch(e){DJSUtil.log("[ DJS ] "+out)}},DJSUtil.inspect=function(object){if(options.verbose)try{console.info(object)}catch(e){DJSUtil.log(object)}},DJSUtil.globalEval=function(string){window.execScript?window.execScript(string):window.eval.call(window,string)},DJSUtil.forEach=DJSUtil.forEach||function(list,callback,context){if(list.forEach)list.forEach(callback,context);else if(typeof list.length=="number"){for(var index=0,item;item=list[index];index++)if(callback.call(context,item,index,list)===!1)return}else for(var j in list)if(list.hasOwnProperty(j)&&callback.call(context,list[j],j,list)===!1)return},DJSUtil.navigator={IE:window.navigator.userAgent.indexOf("MSIE")!==-1,Chrome:window.navigator.userAgent.indexOf("Chrome/")!==-1,Opera:window.navigator.userAgent.indexOf("Opera")!==-1,Webkit:window.navigator.userAgent.indexOf("AppleWebKit")!==-1,Firefox:window.navigator.userAgent.indexOf("Firefox/")!==-1},DJSUtil.feature={createElementCallApply:!!document.createElement.call,attachEventCallApply:!!window.attachEvent&&!!window.attachEvent.call,standardEvents:!!window.addEventListener,defineSetterGetter:!!document.__defineSetter__&&!!document.__defineGetter__},DJSUtil.getAttribute=function(attribute){var self=this;return self.getAttribute?self.getAttribute(attribute):self.attributes[attribute]},DJSUtil.setAttribute=function(attribute,value){var self=this;self.setAttribute?self.setAttribute(attribute,value):self.attributes[attribute]=value},DJSUtil.getData=function(key){var self=this;return self.dataset?self.dataset[key]:DJSUtil.getAttribute.call(self,"data-"+key)},DJSUtil.setData=function(key,value){var self=this;self.dataset?self.dataset[key]=value:DJSUtil.setAttribute.call(self,"data-"+key)},DJSUtil.addEventListener=function(event,listener,captures){var self=this;DJSUtil.feature.standardEvents?self.addEventListener(event,listener,captures):self.attachEvent("on"+event,listener)},DJSUtil.removeEventListener=function(event,listener,captures){var self=this;DJSUtil.feature.standardEvents?self.removeEventListener(event,listener,captures):self.detachEvent("on"+event,listener)};var DJSParserSemantics={};DJSParserSemantics.elementSemantics={head:{contentCategories:{},contentModel:"metadata"},title:{contentCategories:{metadata:1},contentModel:"text"},base:{contentCategories:{metadata:1},contentModel:"empty"},link:{contentCategories:{metadata:1},contentModel:"empty"},meta:{contentCategories:{metadata:1},contentModel:"empty"},style:{contentCategories:{metadata:1,flow:1},contentModel:"text"},script:{contentCategories:{metadata:1,flow:1,phrasing:1},contentModel:"text"},noscript:{contentCategories:{metadata:1,flow:1,phrasing:1},contentModel:"transparent",exclusive:{noscript:"recursive"}},body:{contentCategories:{sectioning:1},contentModel:"flow"},section:{contentCategories:{flow:1,sectioning:1},contentModel:"flow"},nav:{contentCategories:{flow:1,sectioning:1},contentModel:"flow"},article:{contentCategories:{flow:1,sectioning:1},contentModel:"flow"},aside:{contentCategories:{flow:1,sectioning:1},contentModel:"flow"},h1:{contentCategories:{flow:1,heading:1},contentModel:"phrasing"},h2:{contentCategories:{flow:1,heading:1},contentModel:"phrasing"},h3:{contentCategories:{flow:1,heading:1},contentModel:"phrasing"},h4:{contentCategories:{flow:1,heading:1},contentModel:"phrasing"},h5:{contentCategories:{flow:1,heading:1},contentModel:"phrasing"},h6:{contentCategories:{flow:1,heading:1},contentModel:"phrasing"},hgroup:{contentCategories:{flow:1,heading:1},contentModel:"empty",inclusive:{h1:1,h2:1,h3:1,h4:1,h5:1,h6:1}},header:{contentCategories:{flow:1},contentModel:"flow",exclusive:{header:"recursive",footer:"recursive"}},footer:{contentCategories:{flow:1},contentModel:"flow",exclusive:{header:"recursive",footer:"recursive"}},address:{contentCategories:{flow:1},contentModel:"flow",exclusive:{address:"recursive",header:"recursive",footer:"recursive"}},p:{contentCategories:{flow:1},contentModel:"phrasing"},hr:{contentCategories:{flow:1},contentModel:"empty"},pre:{contentCategories:{flow:1},contentModel:"phrasing"},blockquote:{contentCategories:{flow:1,sectioning:1},contentModel:"flow"},ol:{contentCategories:{flow:1},contentModel:"empty",inclusive:{li:1}},ul:{contentCategories:{flow:1},contentModel:"empty",inclusive:{li:1}},li:{contentCategories:{},contentModel:"flow"},dl:{contentCategories:{flow:1},contentModel:"empty",inclusive:{dt:1,dd:1}},dt:{contentCategories:{},contentModel:"phrasing"},dd:{contentCategories:{},contentModel:"flow"},figure:{contentCategories:{flow:1,sectioning:1},contentModel:"flow",inclusive:{figcaption:1}},figcaption:{contentCategories:{},contentModel:"flow"},div:{contentCategories:{flow:1},contentModel:"flow"},a:{contentCategories:{flow:1,phrasing:1,interactive:1},contentModel:"transparent",exclusive:{}},em:{contentCategories:{flow:1,phrasing:1},contentModel:"phrasing"},strong:{contentCategories:{flow:1,phrasing:1},contentModel:"phrasing"},small:{contentCategories:{flow:1,phrasing:1},contentModel:"phrasing"},s:{contentCategories:{flow:1,phrasing:1},contentModel:"phrasing"},cite:{contentCategories:{flow:1,phrasing:1},contentModel:"phrasing"},q:{contentCategories:{flow:1,phrasing:1},contentModel:"phrasing"},dfn:{contentCategories:{flow:1,phrasing:1},contentModel:"phrasing",exclusive:{dfn:"recursive"}},abbr:{contentCategories:{flow:1,phrasing:1},contentModel:"phrasing"},time:{contentCategories:{flow:1,phrasing:1},contentModel:"phrasing"},code:{contentCategories:{flow:1,phrasing:1},contentModel:"phrasing"},"var":{contentCategories:{flow:1,phrasing:1},contentModel:"phrasing"},abbr:{contentCategories:{flow:1,phrasing:1},contentModel:"phrasing"},samp:{contentCategories:{flow:1,phrasing:1},contentModel:"phrasing"},kbd:{contentCategories:{flow:1,phrasing:1},contentModel:"phrasing"},sub:{contentCategories:{flow:1,phrasing:1},contentModel:"phrasing"},sup:{contentCategories:{flow:1,phrasing:1},contentModel:"phrasing"},i:{contentCategories:{flow:1,phrasing:1},contentModel:"phrasing"},b:{contentCategories:{flow:1,phrasing:1},contentModel:"phrasing"},mark:{contentCategories:{flow:1,phrasing:1},contentModel:"phrasing"},ruby:{contentCategories:{flow:1,phrasing:1},contentModel:"phrasing",inclusive:{rt:1,rp:1}},rt:{contentCategories:{},contentModel:"phrasing"},rp:{contentCategories:{},contentModel:"phrasing"},bdi:{contentCategories:{flow:1,phrasing:1},contentModel:"phrasing"},bdo:{contentCategories:{flow:1,phrasing:1},contentModel:"phrasing"},span:{contentCategories:{flow:1,phrasing:1},contentModel:"phrasing"},br:{contentCategories:{flow:1,phrasing:1},contentModel:"empty"},wbr:{contentCategories:{flow:1,phrasing:1},contentModel:"empty"},ins:{contentCategories:{flow:1,phrasing:1},contentModel:"transparent"},del:{contentCategories:{flow:1,phrasing:1},contentModel:"transparent"},img:{contentCategories:{flow:1,phrasing:1,embedded:1},contentModel:"empty"},iframe:{contentCategories:{flow:1,phrasing:1,embedded:1,interactive:1},contentModel:"transparent"},embed:{contentCategories:{flow:1,phrasing:1,embedded:1,interactive:1},contentModel:"empty"},object:{contentCategories:{flow:1,phrasing:1,embedded:1,interactive:1},contentModel:"transparent",inclusive:{param:1}},param:{contentCategories:{},contentModel:"empty"},video:{contentCategories:{flow:1,phrasing:1,embedded:1},contentModel:"transparent"},audio:{contentCategories:{flow:1,phrasing:1,embedded:1,interactive:1},contentModel:"transparent"},source:{contentCategories:{},contentModel:"empty"},track:{contentCategories:{},contentModel:"empty"},canvas:{contentCategories:{flow:1,phrasing:1,embedded:1},contentModel:"transparent"},map:{contentCategories:{flow:1,phrasing:1},contentModel:"transparent"},area:{contentCategories:{flow:1,phrasing:1},contentModel:"empty"},table:{contentCategories:{flow:1},contentModel:"empty",inclusive:{caption:1,colgroup:1,thead:1,tfoot:1,tbody:1,tr:1}},caption:{contentCategories:{},contentModel:"flow",exclusive:{table:"recursive"}},colgroup:{contentCategories:{},contentModel:"empty",inclusive:{col:1}},col:{contentCategories:{},contentModel:"empty"},tbody:{contentCategories:{},contentModel:"empty",inclusive:{tr:1}},thead:{contentCategories:{},contentModel:"empty",inclusive:{tr:1}},tfoot:{contentCategories:{},contentModel:"empty",inclusive:{tr:1}},tr:{contentCategories:{},contentModel:"empty",inclusive:{td:1,th:1}},td:{contentCategories:{sectioning:1},contentModel:"flow"},th:{contentCategories:{},contentModel:"phrasing"},form:{contentCategories:{flow:1},contentModel:"flow",exclusive:{form:"recursive"}},fieldset:{contentCategories:{flow:1,sectioning:1},contentModel:"flow",inclusive:{legend:1}},legend:{contentCategories:{},contentModel:"phrasing"},label:{contentCategories:{flow:1,phrasing:1,interactive:1},contentModel:"phrasing"},input:{contentCategories:{flow:1,phrasing:1,interactive:1},contentModel:"empty"},button:{contentCategories:{flow:1,phrasing:1,interactive:1},contentModel:"phrasing"},select:{contentCategories:{flow:1,phrasing:1,interactive:1},contentModel:"empty",inclusive:{option:1,optgroup:1}},datalist:{contentCategories:{flow:1,phrasing:1},contentModel:"phrasing",inclusive:{option:1}},optgroup:{contentCategories:{},contentModel:"empty",inclusive:{option:1}},option:{contentCategories:{},contentModel:"text"},textarea:{contentCategories:{flow:1,phrasing:1,interactive:1},contentModel:"text"},keygen:{contentCategories:{flow:1,phrasing:1,interactive:1},contentModel:"empty"},output:{contentCategories:{flow:1,phrasing:1},contentModel:"phrasing"},progress:{contentCategories:{flow:1,phrasing:1},contentModel:"phrasing",exclusive:{progress:"recursive"}},meter:{contentCategories:{flow:1,phrasing:1},contentModel:"phrasing",exclusive:{meter:"recursive"}},details:{contentCategories:{flow:1,sectioning:1,interactive:1},contentModel:"flow",inclusive:{summary:1}},summary:{contentCategories:{},contentModel:"phrasing"},command:{contentCategories:{metadata:1,flow:1,phrasing:1},contentModel:"empty"},menu:{contentCategories:{flow:1,interactive:1},contentModel:"flow",inclusive:{li:1}}},DJSParserSemantics.isValidParent=function(node,parentNode){var checkExplicitRules=function(parentRules,nodeName){if(parentRules.inclusive&&nodeName in parentRules.inclusive)return!0;if(parentRules.exclusive&&nodeName in parentRules.exclusive)return!1;return null},checkContentModel=function(parentRules,nodeRules){var conclusion;switch(parentRules.contentModel){case"transparent":conclusion=!0;break;case"empty":conclusion=!1;break;default:conclusion=parentRules.contentModel in nodeRules.contentCategories}return conclusion},rules=DJSParserSemantics.elementSemantics,nodeName=node.nodeName.toLowerCase(),parentNodeName=parentNode.nodeName.toLowerCase(),parentRules,conclusion;if(!rules[parentNodeName])return!0;parentRules=rules[parentNodeName],conclusion=checkExplicitRules(rules[parentNodeName],nodeName);if(conclusion!==null)return conclusion;if(!rules[nodeName]||!rules[nodeName].contentCategories||!parentRules.contentModel)return!0;return checkContentModel(parentRules,rules[nodeName])},DJSParserSemantics.mixins={convertAbstractElement:function(abstractElement){var self=this,document=self.document,setNodeAttributes=function(node,attributes){attributes&&DJSUtil.forEach(attributes,function(value,key){switch(key){case"class":node.className+=value;break;default:DJSUtil.setAttribute.call(node,key,value)}})};switch(abstractElement.type){case"text":return document.createTextNode(abstractElement.data);case"comment":return document.createComment(abstractElement.data);case"script":var script=document.createElement(abstractElement.name);setNodeAttributes(script,abstractElement.attribs);return script;case"style":case"tag":var node=document.createElement(abstractElement.name);setNodeAttributes(node,abstractElement.attribs);return node;case"directive":DJSUtil.log("Ignoring an HTML directive found in document.write stream "+abstractElement.raw);return!1;default:DJSUtil.error("WARNING: unexpected element type found: "+abstractElement.raw);return!1}},insert:function(abstractDOM,rawParent){var self=this,document=self.document;DJSUtil.forEach(abstractDOM,function(data){var getEffectiveStreamCursor=function(){var rawCursor={parent:null,sibling:null};rawParent?rawCursor.parent=rawParent:self.streamCursor.executingScript?(rawCursor.parent=self.streamCursor.executingScript.parentNode,rawCursor.sibling=self.streamCursor.executingScript):rawCursor.parent=document.body;return function getFirstNonClosedParent(cursor){var finalCursor;cursor.parent.closed?cursor.parent.parentNode?finalCursor=getFirstNonClosedParent({parent:cursor.parent.parentNode,sibling:cursor.parent}):finalCursor={parent:document.body,sibling:null}:finalCursor=cursor;return finalCursor}(rawCursor)},findValidAncestorAndCloseNodes=function(node,cursor){var parent=cursor.parent;if(DJSParserSemantics.isValidParent(node,parent))return cursor;parent.closed=!0;return parent.parentNode?findValidAncestorAndCloseNodes(node,{parent:parent.parentNode,sibling:parent}):document.body},insertAfter=function(node,target){target.nextSibling?target.parentNode.insertBefore(node,target.nextSibling):target.parentNode.appendChild(node)},cursor=getEffectiveStreamCursor(),node=self.convertAbstractElement(data),name=node.nodeName.toLowerCase();try{if(cursor.parent.nodeName.toLowerCase()=="script"&&name=="#text")cursor.parent.text=node.nodeValue;else{var parent,sibling;cursor=findValidAncestorAndCloseNodes(node,cursor),parent=cursor.parent,sibling=cursor.sibling,sibling?insertAfter(node,sibling):parent.appendChild(node)}data.children&&self.insert(data.children,node)}catch(e){DJSUtil.log("Insert failed"),DJSUtil.error(e)}})}};var DJSDominatrix=function(sub){var self=this;self.target=sub,self.deferredProperties=[]};DJSDominatrix.prototype={watchProperty:function(propertyString){var self=this,target=self.target,deferredProperties=self.deferredProperties;!DJSUtil.defineSetterGetter}};var DJSDocument=function(document){var self=this;self.document=document,self.subscriptQueue=[],self.nativeMethods={write:document.write,writeln:document.writeln,createElement:document.createElement,addEventListener:document.addEventListener,attachEvent:document.attachEvent},self.handlers={DOMContentLoaded:[],readystatechange:[]},html?(self.hasWriteBuffer=!1,self.parser=new html.Parser(new html.DefaultHandler(function(error,dom){error?DJSUtil.error("PARSER ERROR: "+error):self.insert(dom)}))):DJSUtil.error("Warning: no HTML parser detected. Document.write will be disabled!")};DJSDocument.prototype={restore:function(){var self=this,document=self.document,nativeMethods=self.nativeMethods;document.createElement=nativeMethods.createElement,document.write=nativeMethods.write,document.writeln=nativeMethods.writeln,document.addEventListener=nativeMethods.addEventListener,document.attachEvent=nativeMethods.attachEvent},dominate:function(){var self=this,document=self.document,nativeMethods=self.nativeMethods,handlers=self.handlers;document.write=document.writeln=function(out){self.write(out)},document.createElement=function(type){var args=arguments,element=DJSUtil.feature.createElementCallApply?nativeMethods.createElement.apply(document,args):nativeMethods.createElement(type);type.indexOf("script")!=-1&&self.queueSubscript(element);return element},document.__defineSetter__&&document.__defineGetter__?(window.__defineSetter__("onreadystatechange",function(handler){self.onreadystatechange=handler}),window.__defineGetter__("onreadystatechange",function(){return self.onreadystatechange})):self.fallback=!0,document.addEventListener?(document.addEventListener=function(event,handler){handlers[event]?handlers[event].push(handler):nativeMethods.addEventListener.apply(document,arguments)},DJSUtil.forEach(handlers,function(handlerArray,eventName){nativeMethods.addEventListener.call(document,eventName,function(event){self[eventName+"Event"]=event},!0)})):document.attachEvent&&(document.attachEvent=function(event,handler){var trimmedEvent=event.substring(2);handlers[trimmedEvent]?handlers[trimmedEvent].push(handler):nativeMethods.attachEvent(event,handler)},DJSUtil.forEach(handlers,function(handlerArray,eventName){nativeMethods.attachEvent("on"+eventName,function(event){self[eventName+"Event"]=event})}))},ready:function(){var self=this,document=self.document,handlers=self.handlers;self.readystatechangeEvent&&DJSUtil.forEach(handlers.readystatechange,function(handler){handler(self.readystatechangeEvent)}),(self.DOMContentLoadedEvent||!0)&&DJSUtil.forEach(handlers.DOMContentLoaded,function(handler){handler(self.DOMContentLoadedEvent)})},queueSubscript:function(element){DJSUtil.log("Queueing a subscript of the current execution: "),DJSUtil.inspect(element);var self=this,subscriptQueue=self.subscriptQueue,parentStreamCursor=self.streamCursor,popQueue=function(){subscriptQueue.pop(),subscriptQueue.length==0&&slaveScripts.resume()},removeHandlers=function(){DJSUtil.removeEventListener.call(element,"load",loadHandler,!0),DJSUtil.removeEventListener.call(element,"readystatechange",loadHandler,!0),DJSUtil.removeEventListener.call(element,"error",errorHandler,!0)},loadHandler=function(){var readyState=element.readyState;clearTimeout(timeout);if(!readyState||readyState=="complete"||readyState=="loaded")self.flush(),self.streamCursor=parentStreamCursor,removeHandlers(),popQueue()},errorHandler=function(){self.streamCursor=parentStreamCursor,removeHandlers(),popQueue()},timeout=setTimeout(function(){element.parentNode||(DJSUtil.log("Subscript took too long to be inserted. Bailing out!"),errorHandler())},30);slaveScripts.pause(),self.streamCursor={executingScript:element||document.body.firstChild},DJSUtil.navigator.IE?DJSUtil.addEventListener.call(element,"readystatechange",loadHandler,!0):DJSUtil.addEventListener.call(element,"load",loadHandler,!0),DJSUtil.addEventListener.call(element,"error",errorHandler,!0)},write:function(out){var self=this,parser=self.parser;DJSUtil.log("Buffering document.write content: "+out),parser&&(self.hasWriteBuffer=!0,parser.parseChunk(out))},flush:function(){var self=this;DJSUtil.log("Flushing document.write buffer!"),self.hasWriteBuffer&&(self.parser.done(),self.parser.reset(),self.hasWriteBuffer=!1)},convertAbstractElement:function(abstractElement){var self=this;if(DJSParserSemantics)return DJSParserSemantics.mixins.convertAbstractElement.apply(self,arguments)},insert:function(abstractDOM,rawParent){var self=this;if(DJSParserSemantics)return DJSParserSemantics.mixins.insert.apply(self,arguments)}};var DJSWindow=function(window){var self=this;self.window=window,self.nativeMethods={addEventListener:window.addEventListener,attachEvent:window.attachEvent},self.handlers={load:[]}};DJSWindow.prototype={restore:function(){var self=this,window=self.window,nativeMethods=self.nativeMethods;window.addEventListener=nativeMethods.addEventListener,window.attachEvent=nativeMethods.attachEvent,self.onload&&(window.onload=self.onload)},dominate:function(){var self=this,window=self.window,nativeMethods=self.nativeMethods,handlers=self.handlers;if(window.__defineSetter__&&window.__defineGetter__){var windowOnloadHandler;window.__defineSetter__("onload",function(handler){self.onload=handler}),window.__defineGetter__("onload",function(){return self.onload})}else self.fallback=!0;window.addEventListener?(window.addEventListener=function(event,handler){handlers[event]?handlers[event].push(handler):nativeMethods.addEventListener.apply(window,arguments)},nativeMethods.addEventListener.call(window,"load",function(event){self.loadEvent=event},!0)):window.attachEvent&&(window.attachEvent=function(event,handler){var trimmedEvent=event.substring(2);handlers[trimmedEvent]?handlers[trimmedEvent].push(handler):DJSUtil.feature.attachEventCallApply?nativeMethods.attachEvent.apply(window,arguments):nativeMethods.attachEvent(event,handler)},nativeMethods.attachEvent("onload",function(event){self.loadEvent=event}))},whenLoaded:function(callback){var self=this,window=self.window,nativeMethods=self.nativeMethods;document.readyState==="complete"?callback():nativeMethods.addEventListener?nativeMethods.addEventListener.call(window,"load",callback,!0):nativeMethods.attachEvent("onload",callback)},load:function(){var self=this,window=self.window,handlers=self.handlers;self.onload&&self.onload(self.loadEvent),DJSUtil.forEach(handlers.load,function(handler){handler(self.loadEvent)}),self.fallback&&window.onload&&setTimeout(function(){window.onload(self.loadEvent)},10)}};var DJSScript=function(script){var self=this;self.originalScript=script,self.src=DJSUtil.getData.call(script,"djssrc"),self.external=!!self.src,self.loadHandlers=[],script.dominated=!0};DJSScript.prototype={precache:function(callback){var self=this,loadHandlers=self.loadHandlers;if(self.external){var precacheObject,loadHandler=function(){DJSUtil.log("Finished precache-ing resource at "+self.src),self.ready=!0,DJSUtil.forEach(self.loadHandlers,function(handler){handler(self)}),callback&&callback(self.src),detachHandlers()},errorHandler=function(){DJSUtil.log("Failed to precache resource at "+self.src),callback&&callback(!1),detachHandlers()},attachHandlers=function(){precacheObject.onload=loadHandler,precacheObject.onerror=errorHandler},detachHandlers=function(){precacheObject.onload=precacheObject.onerror=null};DJSUtil.log("Precache-ing script at "+self.src);if(DJSUtil.navigator.IE||DJSUtil.navigator.Opera)precacheObject=new Image,attachHandlers(),precacheObject.src=self.src;else{var appendTarget=DJSUtil.navigator.Firefox?document.getElementsByTagName("head")[0]:document.body;precacheObject=document.createElement("object"),attachHandlers(),precacheObject.data=self.src,precacheObject.width=0,precacheObject.height=0,precacheObject.style.position="absolute",precacheObject.style.left="-999",appendTarget.appendChild(precacheObject)}}else self.ready=!0,DJSUtil.forEach(self.loadHandlers,function(handler){handler(self)}),callback&&callback(!0)},execute:function(callback){var self=this,script=self.originalScript;slaveDocument.streamCursor={executingScript:script||document.body.firstChild};if(self.external){var createElement=slaveDocument.nativeMethods.createElement,newScript=DJSUtil.feature.createElementCallApply?createElement.call(document,"script"):createElement("script"),detachHandlers=function(){newScript.onload=newScript.onreadystatechange=newScript.onerror=null};DJSUtil.log("Executing external script from "+self.src+"..."),newScript.onload=newScript.onreadystatechange=function(){var readyState=newScript.readyState;if(!readyState||readyState=="complete"||readyState=="loaded")slaveDocument.flush(),detachHandlers(),callback(self.src)},newScript.onerror=function(){DJSUtil.error("Error while attempting to execute this external script: "+self.src),detachHandlers(),callback(!1)},newScript.src=self.src,script.parentNode.insertBefore(newScript,script)}else{DJSUtil.log("Executing an inline script...");try{DJSUtil.globalEval(script.text),slaveDocument.flush()}catch(e){DJSUtil.error(e+" while attempting to execute this inline script: "),DJSUtil.inspect(script),callback(!1)}callback(!0)}},whenLoaded:function(callback){var self=this,loadHandlers=self.loadHandlers;self.ready?callback(self):loadHandlers.push(callback)}},DJSScriptManager=function(){var self=this;self.slaves=[],self.captives=[],self.urlCache={},self.executing=!1,self.currentExecution=null,self.paused=self.breakExecution=!1},DJSScriptManager.prototype={dominate:function(once){var self=this,urlCache=self.urlCache,captives=self.captives,scripts=document.getElementsByTagName("script"),enslavedCount=0,passCount=0,complete=function(){DJSUtil.log("Detected a total of "+enslavedCount+" undominated scripts...")},search=function(){passCount++,DJSUtil.forEach(scripts,function(script,index){if(!script.dominated&&DJSUtil.getAttribute.call(script,"type")==="text/djs"){var slave=new DJSScript(script);captives.push(slave),self.executing?slave.ready=!0:setTimeout(function(){slave.precache()},1),enslavedCount++}});if(passCount>2||once)clearInterval(searchLoop),complete()},searchLoop=setInterval(search,25);search()},execute:function(callback){var self=this,paused=self.paused;if(!paused){var captives=self.captives,slaves=self.slaves,executionCallback=self.executionCallback,executeNext=function(){self.breakExecution?(DJSUtil.log("Pausing execution..."),self.paused=!0):self.execute()};self.executionCallback=callback||self.executionCallback,self.executing=!!self.executionCallback;if(captives.length){var slave=captives[0];!self.currentExecution&&self.executing&&(DJSUtil.log("Queueing execution of next script..."),self.currentExecution=captives.shift(),slave.whenLoaded(function(){slave.execute(function(success){success?(slaves.push(slave),DJSUtil.log("Execution finished for this script: "),DJSUtil.inspect(slave),self.currentExecution=null,DJSUtil.log("Executed "+slaves.length+" scripts so far; "+captives.length+" scripts left in the queue...")):DJSUtil.error("Failed execution!"),executeNext()})}));return}DJSUtil.log("Performing fallback scan for scripts.."),self.dominate(!0);if(captives.length){executeNext();return}if(!captives.length&&self.executionCallback){self.executionFinished||(DJSUtil.log("Looks like we are done dominating!"),self.executionCallback(),self.executionFinished=!0);return}}},pause:function(){var self=this;self.breakExecution=!0},resume:function(){var self=this;self.breakExecution=!1,self.paused&&(DJSUtil.log("Resuming execution..."),self.paused=!1,self.execute())}};var slaveDocument=new DJSDocument(document),slaveWindow=new DJSWindow(window),slaveScripts=new DJSScriptManager;DJSUtil.log("Dominating the window and any appropriate scripts!"),slaveWindow.dominate(),slaveScripts.dominate(),slaveWindow.whenLoaded(function(){DJSUtil.log("Show time. Dominating the document and executing scripts!"),slaveDocument.dominate(),slaveScripts.execute(function(){DJSUtil.log("Finished executing. Simulating load, ready and readystatechange events!"),slaveDocument.ready(),slaveWindow.load(),DJSUtil.log("Restoring native DOM methods!"),slaveDocument.restore(),slaveWindow.restore(),DJSUtil.log("Took "+((new Date).getTime()-DJSUtil.epoch)+"ms for total domination!"),DJSUtil.log("Fin.")})})}(window,document,typeof DJS!="undefined"?DJS:{},typeof exports!="undefined"?exports:!1,typeof DJSParserSemantics!="undefined"?DJSParserSemantics:!1)})(window,document)